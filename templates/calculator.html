<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dividend Calculator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Dividend Growth Calculator</h1>
        <button class="btn btn-secondary" onclick="document.body.classList.toggle('dark-mode')">
            Toggle Dark Mode
        </button>

        <form method="POST">
          <div class="form-group">
    <label for="tickers">Ticker Symbol(s) (e.g., AAPL, MSFT, VOO):</label>
    <select class="form-control" id="tickers" name="tickers" multiple="multiple" required style="width: 100%; background-color: black; color: white;">
        <option value="MSFT">MSFT</option>
<option value="AAPL">AAPL</option>
<option value="NVDA">NVDA</option>
<option value="AMZN">AMZN</option>
<option value="GOOGL">GOOGL</option>
<option value="GOOG">GOOG</option>
<option value="META">META</option>
<option value="TSLA">TSLA</option>
<option value="AMD">AMD</option>
<option value="INTC">INTC</option>
<option value="CSCO">CSCO</option>
<option value="AVGO">AVGO</option>
<option value="ORCL">ORCL</option>
<option value="ADBE">ADBE</option>
<option value="CRM">CRM</option>
<option value="QCOM">QCOM</option>
<option value="NFLX">NFLX</option>
<option value="IBM">IBM</option>
<option value="PLTR">PLTR</option>
<option value="SNOW">SNOW</option>
<option value="JPM">JPM</option>
<option value="BAC">BAC</option>
<option value="GS">GS</option>
<option value="WFC">WFC</option>
<option value="MS">MS</option>
<option value="SCHW">SCHW</option>
<option value="AXP">AXP</option>
<option value="WMT">WMT</option>
<option value="COST">COST</option>
<option value="HD">HD</option>
<option value="TGT">TGT</option>
<option value="PG">PG</option>
<option value="KO">KO</option>
<option value="PEP">PEP</option>
<option value="NKE">NKE</option>
<option value="MCD">MCD</option>
<option value="SBUX">SBUX</option>
<option value="UNH">UNH</option>
<option value="JNJ">JNJ</option>
<option value="LLY">LLY</option>
<option value="MRK">MRK</option>
<option value="PFE">PFE</option>
<option value="ABBV">ABBV</option>
<option value="MRNA">MRNA</option>
<option value="XOM">XOM</option>
<option value="CVX">CVX</option>
<option value="SLB">SLB</option>
<option value="CAT">CAT</option>
<option value="HON">HON</option>
<option value="GE">GE</option>
<option value="SPY">SPY</option>
<option value="VOO">VOO</option>
<option value="QQQ">QQQ</option>
<option value="VTI">VTI</option>
<option value="EEM">EEM</option>
<option value="ARKK">ARKK</option>
<option value="BABA">BABA</option>
<option value="TM">TM</option>
<option value="SSNLF">SSNLF</option>
<option value="NSRGY">NSRGY</option>
<option value="NESN.SW">NESN.SW</option>
<option value="SONY">SONY</option>
<option value="ASML">ASML</option>
<option value="SIEGY">SIEGY</option>
<option value="SIE.DE">SIE.DE</option>
<option value="TCS.NS">TCS.NS</option>
<option value="INFY">INFY</option>

    </select>
</div>
            
            <div class="form-group">
                <label for="initial_investment">Initial Investment ($):</label>
                <input type="number" class="form-control" id="initial_investment" name="initial_investment" value="{{ initial_investment if initial_investment is not none else '10000' }}" step="any" required>
            </div>
            <div class="form-group">
                <label for="investment_years">Investment Years:</label>
                <input type="number" class="form-control" id="investment_years" name="investment_years" value="{{ investment_years if investment_years is not none else '10' }}" required>
            </div>
          <div class="form-group">
                <label for="annual_yield">Annual Yield (%):</label>
                <input type="number" class="form-control" id="annual_yield" name="annual_yield" value="5" step="any" required>
            </div> 
            <div class="form-group">
                <label>Dividend Reinvestment Plan (DRIP):</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="drip_enabled" id="drip_yes" value="yes" {{ 'checked' if drip_enabled == 'yes' or drip_enabled is none else '' }}>
                    <label class="form-check-label" for="drip_yes">Yes</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="drip_enabled" id="drip_no" value="no" {{ 'checked' if drip_enabled == 'no' else '' }}>
                    <label class="form-check-label" for="drip_no">No</label>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Calculate</button>
        </form>

        {% if results %}
            <div class="results-section">
                <h2>Individual Stock Results</h2>
                {% for result in results %}
                    <h3>{{ result.ticker }}</h3>
                    {% if result.error %}
                        <p class="error">{{ result.error }}</p>
                    {% else %}
                        <p><strong>Current Price:</strong> {{ result.current_price }}</p>
                     <!--   <p><strong>Annual Dividend Per Share:</strong> {{ result.annual_dividend_per_share }}</p> -->
                       <!-- <p><strong>Dividend Yield:</strong> {{ result.dividend_yield }}</p> -->
                      <!--  <p><strong>Payout Ratio:</strong> {{ result.payout_ratio }}</p>-->
                      <!--  <p><strong>Initial Shares:</strong> {{ result.initial_shares }}</p>-->
                        <p><strong>Final Value (No DRIP):</strong> {{ result.final_value_no_drip }}</p>
                        <p><strong>Final Value (With DRIP):</strong> {{ result.final_value_with_drip }}</p>
                    {% endif %}
                {% endfor %}
            </div>

            {% if comparison_table %}
                <div class="comparison-section">
                    <h2>Comparison of Scenarios</h2>
                    {{ comparison_table | safe }}
                </div>
            {% endif %}

            {% if plot_url %}
                <div class="chart-section">
                    <h2>Portfolio Growth Chart</h2>
                    <img src="{{ plot_url }}" alt="Portfolio Growth Chart">
                </div>
            {% endif %}

            <div class="export-options mt-4">
                <h2>Export Results</h2>
                <form action="/export_csv" method="POST" style="display:inline;">
                    <input type="hidden" id="export_tickers_hidden" name="export_tickers">
                    <input type="hidden" name="export_initial_investment" value="{{ request.form.get('initial_investment') }}">
                    <input type="hidden" name="export_investment_years" value="{{ request.form.get('investment_years') }}">
                    <input type="hidden" name="export_drip_enabled" value="{{ 'true' if request.form.get('drip_enabled') == 'yes' else 'false' }}">
                    <button type="submit" class="btn btn-success" onclick="updateExportTickers()">Export to CSV</button>
                </form>
            </div>
        {% endif %}
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        // Initialize Select2 on your #tickers element
        $(document).ready(function() {
            $('#tickers').select2({
                placeholder: "Select or search for ticker symbols",
                allowClear: true,
                tags: true,
                tokenSeparators: [',', ' ']
            });

            // Set the initially selected tickers if coming from a POST request
            const initialTickersInput = "{{ tickers_input | default('') }}"; // Use default filter
            if (initialTickersInput) {
                const initialTickersArray = initialTickersInput.split(',').map(item => item.trim());
                initialTickersArray.forEach(ticker => {
                    if (ticker && !$('#tickers option[value="' + ticker + '"]').length) {
                        $('#tickers').append(new Option(ticker, ticker, false, false));
                    }
                });
                $('#tickers').val(initialTickersArray).trigger('change');
            }
        });

        // Function to update the hidden export_tickers field before form submission
        function updateExportTickers() {
            const selectedTickers = $('#tickers').val();
            if (selectedTickers) {
                $('#export_tickers_hidden').val(selectedTickers.join(','));
            } else {
                $('#export_tickers_hidden').val('');
            }
        }
    </script>
    
    <script>
        function setDarkMode(isDark) {
            if (isDark) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            setDarkMode(true);
        }

        document.querySelector('button.btn-secondary').addEventListener('click', function() {
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        });

        document.addEventListener('DOMContentLoaded', function() {
            const initialInvestmentInput = document.getElementById('initial_investment');
            if (initialInvestmentInput && !initialInvestmentInput.value) {
                initialInvestmentInput.value = "10000";
            }
            const investmentYearsInput = document.getElementById('investment_years');
            if (investmentYearsInput && !investmentYearsInput.value) {
                investmentYearsInput.value = "10";
            }
        });
    </script>
</body>
</html>